###############################################################################
# Pre-Migration Check
# 
# Este archivo verifica el estado de la base de datos antes de ejecutar
# las migraciones para prevenir errores.
###############################################################################

container_commands:
  00_check_db_connection:
    command: "node -e \"const { Client } = require('pg'); const client = new Client({ host: process.env.DB_HOST, port: process.env.DB_PORT, user: process.env.DB_USERNAME, password: process.env.DB_PASSWORD, database: process.env.DB_DATABASE, ssl: { rejectUnauthorized: false } }); client.connect().then(() => { console.log('✅ DB Connection OK'); client.end(); }).catch(err => { console.error('❌ DB Connection Failed:', err.message); process.exit(1); });\""
    leader_only: true
    ignoreErrors: false
    env:
      NODE_ENV: production
