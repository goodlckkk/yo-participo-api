###############################################################################
# Configuración de Elastic Beanstalk para ejecutar migraciones automáticamente
#
# Este archivo se ejecuta durante el deploy en AWS Elastic Beanstalk.
# Las migraciones se ejecutan DESPUÉS de instalar dependencias y ANTES de
# iniciar la aplicación.
#
# IMPORTANTE:
# - leader_only: true → Solo se ejecuta en 1 instancia (evita duplicados)
# - ignoreErrors: true → Si falla (ej: migraciones ya aplicadas), continúa
###############################################################################

container_commands:
  01_run_migrations:
    command: "npm run migration:run || echo 'Migrations already applied or failed, continuing...'"
    leader_only: true
    ignoreErrors: true
    env:
      NODE_ENV: production
